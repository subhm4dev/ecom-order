# Spring Cloud Config Client configuration
spring:
  application:
    name: order-service
  config:
    import: optional:configserver:http://localhost:8888
  cloud:
    config:
      fail-fast: false
  # Local fallback configuration
  datasource:
    url: jdbc:postgresql://localhost:5432/ecom_order
    username: postgres
    password: postgres
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
    consumer:
      group-id: order-service-group
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
  # Redis for token blacklisting
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}

# JWT Configuration
jwt:
  enabled: true
  identity-service-url: ${IDENTITY_SERVICE_URL:http://localhost:8081}
  jwks-endpoint: /.well-known/jwks.json
  jwks-cache-refresh-interval-ms: ${JWKS_CACHE_REFRESH_INTERVAL_MS:300000}  # 5 minutes

# HTTP Client Configuration (ResilientWebClient)
http-client:
  default-timeout: PT5S  # 5 seconds
  connect-timeout: PT2S  # 2 seconds
  read-timeout: PT5S     # 5 seconds
  write-timeout: PT5S    # 5 seconds
  response-timeout: PT10S # 10 seconds
  circuit-breaker:
    enabled: true
    failure-rate-threshold: 50.0  # Open circuit when 50% requests fail
    wait-duration-in-open-state: PT60S  # Wait 60s before trying again
    ring-buffer-size-in-closed-state: 100
    ring-buffer-size-in-half-open-state: 10
  retry:
    enabled: true
    max-attempts: 3
    wait-duration: PT1S  # Wait 1 second between retries
  rate-limiter:
    enabled: true
    limit-for-period: 100  # Max 100 requests
    limit-refresh-period: PT1M  # Per minute
    timeout-duration: PT5S  # Wait max 5s for permission

# Local fallback configuration if Config Server is unavailable
server:
  port: 8090

logging:
  level:
    root: INFO
    com.ecom: DEBUG

